<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<title>九猫首页</title>
	<link rel="stylesheet" href="/views/mobile/skin/default/css/mui.css" />
	<link rel="stylesheet" href="/views/mobile/skin/default/css/common.css" />
	<link rel="stylesheet" href="/views/mobile/skin/default/css/icons-extra.css" />
	<link rel="stylesheet" href="/views/mobile/skin/default/css/app/shopcar.css" />
	<link rel="stylesheet" href="/views/mobile/skin/default/css/mui.picker.min.css" />
	<link rel="stylesheet" href="/views/mobile/skin/default/css/mui.poppicker.css" />
</head>
<body>
<div id="loading">
	<div class="spinner">
		<div class="spinner-container container1">
			<div class="circle1"></div>
			<div class="circle2"></div>
			<div class="circle3"></div>
			<div class="circle4"></div>
		</div>
		<div class="spinner-container container2">
			<div class="circle1"></div>
			<div class="circle2"></div>
			<div class="circle3"></div>
			<div class="circle4"></div>
		</div>
		<div class="spinner-container container3">
			<div class="circle1"></div>
			<div class="circle2"></div>
			<div class="circle3"></div>
			<div class="circle4"></div>
		</div>
	</div>
</div>
<!--loading页结束-->
<header class="mui-bar mui-bar-nav">
	<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
	<h1 class="mui-title">订单一览</h1>
</header>
<!--订单详情页面-->
<div class="mui-content" style="margin-top:51px">
	<div id="slider" class="mui-slider mui-fullscreen">
		<div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
			<div class="mui-scroll">
				<a class="mui-control-item  mui-control-item0 mui-active" href="#itemmobile0">
					全部订单
				</a>
				<a class="mui-control-item mui-control-item1" href="#itemmobile1">
					待付款
				</a>
				<a class="mui-control-item mui-control-item2" href="#itemmobile2">
					待发货
				</a>
				<a class="mui-control-item mui-control-item3" href="#itemmobile3">
					待收货
				</a>
				<a class="mui-control-item mui-control-item4" href="#itemmobile4">
					已完成订单
				</a>
			</div>
		</div>
		<div class="mui-slider-group">
			<div id="itemmobile0" class="mui-slider-item mui-control-content mui-active">
				<div id="scroll1" class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<div class="mui-table-view" id="main_panel0">
						</div>
						<div class="noOrder">
							<img src="/views/mobile/skin/default/image/havenomore.png" alt="">
						</div>
					</div>
				</div>
			</div>
			<div id="itemmobile1" class="mui-slider-item mui-control-content ">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<div class="mui-table-view" id="main_panel1">

						</div>
					</div>
				</div>
			</div>
			<div id="itemmobile2" class="mui-slider-item mui-control-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<div class="mui-table-view" id="main_panel2">
						</div>
					</div>
				</div>
			</div>
			<div id="itemmobile3" class="mui-slider-item mui-control-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<div class="mui-table-view" id="main_panel3">

						</div>
					</div>
				</div>
			</div>
			<div id="itemmobile4" class="mui-slider-item mui-control-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<div class="mui-table-view" id="main_panel4">
							<!--<div class="mui-table-view-cell">-->
							<!--</div>-->
						</div>
						<div class="haveNoOrder">
							<div>
								<img src="/views/mobile/skin/default/image/bolo_none.jpg" alt="">
								<div>没有已完成订单</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script id="order-detail" type="text/html">
	<% for(var i=0; i<state.length; i++){%>
	<% var order =state[i] %>
	<div class="mui-table-view-cell order-menu">
		<a href="{url:/ucenter/order_detailw}" class="orderToDetaile">
			<div class="order-top">
				<span class="top1">订单编号：<%=order.order_no%></span>
				<span class="mui-pull-right Qorder"><%=order.orderStatusText%></span>
			</div>
			<div class="order-img">
				<% for(var j=0; j<order.goodslist.length; j++){%>
				<img src="<%=order.goodslist[j].img%>" alt="">
				<%}%>
			</div>
		</a>
		<div class="order-bottom">
			<span>订单金额：<span style="color:#e53e42"><%=order.order_amount%>元</span></span>
			<span class="mui-pull-right orderToDo"><%=order.text%></span>
		</div>
	</div>
	<%}%>
</script>
<script src="/views/mobile/javascript/jquery.min.js"></script>
<script src="/views/mobile/javascript/template-native.js"></script>
<script src="/views/mobile/javascript/mui.js"></script>
<script src="/views/mobile/javascript/mui.pullToRefresh.js"></script>
<script src="/views/mobile/javascript/mui.pullToRefresh.material.js"></script>
<script>
	$(window).load(function(){
		$("#loading").fadeOut(300);
	})
//	接收页面传过来的状态值
	var Request = new Object();
	Request = GetRequest();
	var statusOrder=Request["status"];
//	模拟高亮画面
	$('.mui-control-item').removeClass('mui-active')
	$('.mui-control-item'+statusOrder).addClass('mui-active');
	$('.mui-slider-item').removeClass('mui-active')
	$('#itemmobile'+statusOrder).addClass('mui-active');
//	ajax 请求
	mui.ajax('index.php?controller=apic&action=order_list',{
		dataType:'json',//服务器返回json格式数据
		type:'get',//HTTP请求类型
		timeout:10000,//超时时间设置为10秒；
		success:function(data){
			var dat={}
			for(var i=0;i<5;i++){
				 dat[i]={};
				dat[i]['state']=data['state'+i];
				$('#main_panel'+i).html(template('order-detail', dat[i]));
			}
		},
		error:function(xhr,type,errorThrown){
			//异常处理；
			console.log(type);
		}
	});


	mui.init();
	mui('body').on('tap','.orderToDetaile',function(){
		document.location.href=this.href;
	});
	mui('body').on('tap','.orderToDo',function(){
		alert("奔跑吧，少年")
	});

	(function($) {
		var pageNum={
			pageNum0:0,
			pageNum1:0,
			pageNum2:0,
			pageNum3:0,
			pageNum4:0
		}
		//阻尼系数
		var deceleration = mui.os.ios?0.003:0.0009;
		$('.mui-scroll-wrapper').scroll({
			bounce: false,
			indicators: true, //是否显示滚动条
			deceleration:deceleration
		});
		$.ready(function() {
			//循环初始化所有下拉刷新，上拉加载。
			$.each(document.querySelectorAll('.mui-slider-group .mui-scroll'), function(index, pullRefreshEl) {
				$(pullRefreshEl).pullToRefresh({
					down: {
						callback: function() {
							var self = this;
							setTimeout(function() {
								self.endPullDownToRefresh();
							}, 1000);
						}
					},
					up: {
						callback: function() {
							var self = this;
							setTimeout(function(){
								var div = self.element.querySelector('.mui-table-view');
								var num=++pageNum['pageNum'+index];
								self.endPullUpToRefresh();
							}, 1000);
						}
					}
				});
			});
			var createFragment = function(div, pageNum) {
				var fragment = document.createDocumentFragment();
				//	ajax 请求
				mui.ajax('index.php?controller=apic&action=order_list',{
					dataType:'json',//服务器返回json格式数据
					type:'get',//HTTP请求类型
					timeout:10000,//超时时间设置为10秒；
					success:function(data){
						var html1 = template('test',data);
						fragment.innerHTML = html1;
						return fragment;
					},
					error:function(xhr,type,errorThrown){
						//异常处理；
						console.log(type);
					}
				});

			};
		});
	})(mui)
//	获取url传递过来的参数
	function GetRequest() {
		var url = location.search; //获取url中"?"符后的字串
		var theRequest = new Object();
		if (url.indexOf("?") != -1) {
			var str = url.substr(1);
			strs = str.split("&");
			for(var i = 0; i < strs.length; i ++) {
				theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]);
			}
		}
		return theRequest;
	}
</script>
</body>
</html>
