<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>喵粉们说</title>
    <link rel="stylesheet" href="/views/mobile/skin/default/css/mui.css?v=<?php echo time(); ?>" />
    <link rel="stylesheet" type="text/css" href="/views/mobile/skin/default/css/common.css?v=<?php echo time(); ?>"/>
    <link rel="stylesheet" type="text/css" href="/views/mobile/skin/default/css/app/comment/comment1.css?v=<?php echo time(); ?>"/>
</head>
<body>
<div id="comment_detail_Info" v-cloak>
     <header>
     	<div class="detail_shop">
     		<img src="/views/mobile/skin/default/image/admin_ico.png"/>
     		<p>资生堂新透白美肌，夜间祛斑修护凝霜</p>
     		<span >¥<span>452.00</span></span>
     	</div>
     	<div class="detail_pin">
     		<div class="left_p">
     			<p>喵粉总体评价：</p>
     		</div>
     		<div class="right_p">
     			<ul >
     				<li v-for="item in mark">{{item.name}}</li>
     			</ul>
     		</div>
     	</div>
     </header>
     <section>
     	<div class="user_list_detail">
     		<h1>
     			<img src="/views/mobile/skin/default/image/6F65F4C3-37CD-417C-9B83-60BE30B0AB6D@1x.png" />
     			<p>飞雪</p>
     			<div>
     				<span>2016-10-01</span>
     				<span>17:34:02</span>
     			</div>
     		</h1>
     		<div class="img_detail">
     			<div class="scorll">
     				<ul>
     					<li><img src="/views/mobile/skin/default/image/bolo_none.jpg"/></li>
     					<li><img src="/views/mobile/skin/default/image/bolo_none.jpg"/></li>
     					<li><img src="/views/mobile/skin/default/image/bolo_none.jpg"/></li>
     					<li><img src="/views/mobile/skin/default/image/bolo_none.jpg"/></li>
     					<li><img src="/views/mobile/skin/default/image/bolo_none.jpg"/></li>
     				</ul>
     			</div>
     		</div>
     		<div class="label">
     			<ul>
     				<li>物流快</li>
     				<li>物流快</li>
     				<li>物流快</li>
     				<li>物流快</li>
     				<li>物流快</li>
     				<li>物流快</li>
     				<li>物流快</li>
     			</ul>
     		</div>
     		<!--<div class="audio">
     			<img src="/views/mobile/skin/default/image/jmj/audio.png" style="width: 0.7rem;"/>
     			<span class="ee"><span>19</span>’</span>
     		</div>-->
     		<div class="bottom_">
     			
     		</div>
     	</div>
     	
     	<div class="user_list_detail">
     		<h1>
     			<img src="/views/mobile/skin/default/image/6F65F4C3-37CD-417C-9B83-60BE30B0AB6D@1x.png" />
     			<p>飞雪</p>
     			<div>
     				<span>2016-10-01</span>
     				<span>17:34:02</span>
     			</div>
     		</h1>
     		<div class="img_detail">
     			<div class="scorll">
     				<ul>
     					<li><img src="/views/mobile/skin/default/image/bolo_none.jpg"/></li>
     					<li><img src="/views/mobile/skin/default/image/bolo_none.jpg"/></li>
     					<li><img src="/views/mobile/skin/default/image/bolo_none.jpg"/></li>
     					<li><img src="/views/mobile/skin/default/image/bolo_none.jpg"/></li>
     					<li><img src="/views/mobile/skin/default/image/bolo_none.jpg"/></li>
     				</ul>
     			</div>
     		</div>
     		<div class="label">
     			<ul>
     				<li>物流快</li>
     				<li>物流快</li>
     				<li>物流快</li>
     				<li>物流快</li>
     				<li>物流快</li>
     				<li>物流快</li>
     				<li>物流快</li>
     			</ul>
     		</div>
     		<!--<div class="audio">
     			<img src="/views/mobile/skin/default/image/jmj/audio.png" style="width: 0.7rem;"/>
     			<span class="ee"><span>19</span>’</span>
     		</div>-->
     		<div class="bottom_">
     			
     		</div>
     	</div>
     </section>
</div>
<script src="/views/mobile/javascript/jquery.min.js?v=<?php echo time(); ?>"></script>
<script src="/views/mobile/javascript/mui.js?v=<?php echo time(); ?>"></script>
<script src="/views/mobile/javascript/vue.js?v=<?php echo time(); ?>"></script>

<script type="text/javascript">
	var getId="{echo:IReq::get('id')}";
	var vm=new Vue({
	    el:"#comment_detail_Info",
	    data:{
	        id:getId,//获取页面传过来的id
			mark:[],
	    },
	    computed:{
	
	    },
	    mounted:function(){
	    	getTagList(this);
//	        getCommentDetail(this);
	    },
	    methods:{
	//            从本地选择图片或者拍照
	        choImgFun:function(){
	            chooseImage(this);
	        },
	        //删除最后一张已选择的图片
	        delImg:function(key){
	            this.img.splice(key,1);
	            this.choImg.splice(key,1);
	            this.imgLength--;
	        },
	        //图片预览功能
	        perview:function(item){
	            perviewImg(item,this);
	        },
	        //开始录音
	        startV:function(e){
	            console.log(e)
	            var self=this;
	            startRecord(self);
	            //开始录音得清除播放的动画
	            clearInterval(self.v);
	            this.voiceState=2;
	        },
	        voicePlay:function(){
	            //开始录音得清除录音的动画
	            clearInterval(self.f);
	            playVoice(this);
	        },
	        //停止录音
	        endV:function(e){
	            stopRecord(this);
	        },
	        beginStart:function(){
	            this.voice="";
	            this.localVoice="";
	            this.voiceState=2;
	            startRecord(this);
	            //开始录音得清除播放的动画
	            clearInterval(self.v);
	            this.pause=false;
	        },
	        //删除录音功能
	        delVoice:function(){
	            var self=this;
	            this.voice="";
	            clearInterval(self.f);
	            clearInterval(self.v);
	            self.voiceState=1;
	            self.pause=false;
	        },
	//            选择标签,最多只能选择三个标签
	        changeState:function(item){
	            if(this.maxMark>this.markLen){
	                if(!item.cho){
	                    item.cho=true;
	                    this.markLen++
	                }else{
	                    item.cho=false;
	                    this.markLen--
	                }
	            }else{
	                if(item.cho){
	                    item.cho=false;
	                    this.markLen--
	                }
	            }
	        },
	        //提交并上传文件到微信服务器
	        submit:function(){
	            if(!this.checkSub){
	                return false;
	            }
	            this.showLoad=true;
	            upload(this);
	        }
	    }
	})
	function getTagList(self){
	    mui.ajax('/apic/comment_tag_list',{
	        dataType:'json',//服务器返回json格式数据
	        type:'get',//HTTP请求类型
	        timeout:10000,//超时时间设置为10秒
	        success:function(data){
	        	
	            data.data.map(function(item){
	            	
	                item.cho=false;
	            })
	            self.mark=data.data;
	            console.log(self.mark)
	        }
	    });
	}
</script>

<!-- 微信分享 -->
{if:IClient::isWechat() == true}
<?php
    require_once __DIR__ . '/../../../../plugins/wechat/wechat.php';
    $this->wechat = new wechat();
$this->wechat->setConfig();
$this->wechat->config['wechat_jsApiSDK']=1;
$this->wechat->jsApiSDK();
?>
<script type="text/javascript">
    wx.ready(function() {});
    //    从本地选择图片
    function chooseImage(self){
        var lenth=self.maxLength-self.imgLength;
        wx.chooseImage({
            count:lenth , // 最大能上传数量-已传商品数量
            sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
            sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
            success: function (res) {
//                将本地的localIds展示出来
                res.localIds.map(function(item){
                    //直接上传图片
                    self.img.push(item);
                    wx.uploadImage({
                        localId: item, // 需要上传的图片的本地ID，由chooseImage接口获得
                        isShowProgressTips: 1, // 默认为1，显示进度提示
                        success: function (res1) {
                            self.imgLength++;
                            self.choImg.push(res1.serverId);
                        }
                    });
                })

            }
        });
    }
    //图片预览功能
    function perviewImg(item,self){
        console.log(item);
        wx.previewImage({
            current: item, // 当前显示图片的http链接
            urls: self.img // 需要预览的图片http链接列表
        });
    }
    //开始录音
    function startRecord(self){
        wx.startRecord();
        self.f=setInterval(function(){
            self.startNum=(self.startNum+1)%4;
            self.startSrc=self.img_arr[self.startNum];
        },300)
    }
    //结束录音，获取语音信息
    function stopRecord(self){
        wx.stopRecord({
            success: function (res) {
                wx.uploadVoice({
                    localId: res.localId, // 需要上传的音频的本地ID，由stopRecord接口获得
                    isShowProgressTips: 1, // 默认为1，显示进度提示
                    success: function (res1) {
                        clearInterval(self.f);
                        self.localVoice=res.localId;
                        self.voice=res1.serverId;
                        self.voiceState=3;
                    }
                });
            }
        });
        wx.onVoiceRecordEnd({
            // 录音时间超过一分钟没有停止的时候会执行 complete 回调
            complete: function (res) {
                wx.uploadVoice({
                    localId: res.localId, // 需要上传的音频的本地ID，由stopRecord接口获得
                    isShowProgressTips: 1, // 默认为1，显示进度提示
                    success: function (res1) {
                        clearInterval(self.f);
                        self.localVoice=res.localId;
                        self.voice=res1.serverId;
                        self.voiceState=3;
                    }
                });
            }
        });
    }
    //播放录音的函数
    function playVoice(self){
        if(self.pause){
            wx.pauseVoice({
                localId: self.localVoice // 需要暂停的音频的本地ID，由stopRecord接口获得
            });
            clearInterval(self.v);
            self.startSrc1="/views/mobile/skin/default/image/jmj/comment/003.png";
            self.pause=false;
        }else{
            wx.playVoice({
                localId: self.localVoice // 需要播放的音频的本地ID，由stopRecord接口获得
            });
            self.v=setInterval(function(){
                self.startNum=(self.startNum+1)%4;
                self.startSrc1=self.img_arr[self.startNum];
            },300);
            self.pause=true;
        }
    }
    //提交图片 语音
    function upload(self){
//        处理获得的数据
        var sub_data={
            id:self.id,
            tag_id:self.tag_id,
            image_media_id:self.choImg.join(","),
            voice_media_id:self.voice
        };
        console.log("图片"+sub_data.image_media_id);
        console.log("语音"+sub_data.voice_media_id)
        //发送ajax提交后台
        mui.ajax('/apic/comment_add',{
            data:sub_data,
            dataType:'json',//服务器返回json格式数据
            type:'get',//HTTP请求类型
            timeout:10000,//超时时间设置为10秒
            success:function(data){
                self.showLoad=false; //停止加载
                window.location.href="/ucenter/order"
            }
        });
    }
</script>
{/if}



</body>
</html>