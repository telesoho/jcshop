<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<title>九猫首页</title>
	<link rel="stylesheet" href="/views/mobile/skin/default/css/mui.css" />
	<link rel="stylesheet" href="/views/mobile/skin/default/css/common.css" />
	<link rel="stylesheet" href="/views/mobile/skin/default/css/icons-extra.css" />
	<link rel="stylesheet" href="/views/mobile/skin/default/css/app/jiumao.css" />
	<link rel="stylesheet" href="/views/mobile/skin/default/css/app/shopcar.css" />
</head>
<body>
<!--loading页开始-->
<div id="loading">
	<div class="spinner">
		<div class="spinner-container container1">
			<div class="circle1"></div>
			<div class="circle2"></div>
			<div class="circle3"></div>
			<div class="circle4"></div>
		</div>
		<div class="spinner-container container2">
			<div class="circle1"></div>
			<div class="circle2"></div>
			<div class="circle3"></div>
			<div class="circle4"></div>
		</div>
		<div class="spinner-container container3">
			<div class="circle1"></div>
			<div class="circle2"></div>
			<div class="circle3"></div>
			<div class="circle4"></div>
		</div>
	</div>
</div>
<!--loading页结束-->
<section>
	<div id="defaultAddress" class="defaultAddress">
	</div>
</section>
<section>
	<div id="orderBox" class="orderBox">

	</div>
</section>
<section>
	<div class="totalButton box">
		<div class="totalSumPrice"><span>合计：</span><span id="totalPrice_sum">¥238.90</span></div>
		<div class="toPayOrder">提交订单</div>
	</div>
</section>
<script src="/views/mobile/javascript/jquery.min.js"></script>
<script src="/views/mobile/javascript/template-native.js"></script>
<script src="/views/mobile/javascript/mui.js"></script>
<script src="/views/mobile/javascript/lazyload.js"></script>
<script id="test" type="text/html">
	<%if(addressList.length==0){%>
	<!--如果没有收货地址-->
	<a href="{url:/simple/addaddress}">
		<div class="order_addAddr flexbox">
			<div class="img">
				<img src="/views/mobile/skin/default/image/jmj/icon/add.png" alt="" />
			</div>
			<div class="tex">添加收货地址</div>
		</div>
	</a>
	<%}else{%>
	<a href="{url:/simple/addresslist}&rev=cart_order" class="">
		<div class="box">
			<div class="name">
				<span class="text1">收货人：</span>
				<span class="text2"><%=addressList[0].accept_name%></span>
			</div>
			<div class="phone">
				<%=addressList[0].mobile%>
			</div>
		</div>
		<div class="addr flexbox">
			<div class="text1">收货地址：</div>
			<div class="text2"><%=addressList[0].province_val%><%=addressList[0].city_val%><%=addressList[0].area_val%><%=addressList[0].address%></div>
			<div class="text3"><img src="/views/mobile/skin/default/image/jmj/icon/right.png" alt="" /></div>
		</div>
	</a>
	<%}%>
</script>
<script id="wareList" type="text/html">
	<% for(var i=0; i<goodsList.length; i++){%>
	<% var product =goodsList[i] %>
	<div class="orderNum">
		商品编号:<%=product.goods_no%>
	</div>
	<div class="order_product flexbox">
		<div class="img">
			<img src="<%=product.img%>" alt="" />
		</div>
		<div class="content">
			<div class="name"><%=product.name%></div>
			<div class="size">颜色：黑色</div>
			<div class="flexbox">
				<div class="price">￥ <%=product.sell_price%></div>
				<div class="num">x <%=product.count%></div>
			</div>
		</div>
	</div>
	<%}%>
	<div class="distribution">
		<div class="box title">
			<div class="left">配送方式</div>
			<div class="right">EMS</div>
		</div>
	</div>
	<div class="orderTotal">
		<div class="box total">
			<div class="left">合计</div>
			<div class="right box">
				<div class="flexbox">
					<span class="text1">共<%=count%>件商品</span>
					<span class="text2">小计</span>
				</div>
				<span class="text3">¥ <%=final_sum%></span>
			</div>
		</div>
	</div>
</script>
<script id="footer-content" type="text/html">
	<ul class="mui-table-view">
		<li class="mui-table-view-cell">
			共<span style="color:#e53e42"><%=count%></span>件商品
			<span class="mui-pull-right">应付金额：<span style="color:#e53e42">￥<%=final_sum%></span></span>
		</li>
		<%if(addressList.length==0){%>
		<!--如果没有收货地址-->
		<li class="mui-table-view-cell payware">
			<a href="{url:/simple/addaddress}" type="button" class="mui-btn mui-btn-danger payWare">添加收货地址</a>
		</li>
		<%}else{%>
		<li class="mui-table-view-cell payware">
			<!--要跳到支付页面-->
			<a href="" type="button" class="mui-btn mui-btn-danger payWare">确认支付</a>
		</li>
		<%}%>
	</ul>
</script>
<script>
	var addr=true;//判断用户是否提供地址
	mui.ajax('index.php?controller=apic&action=cart2',{
		dataType:'json',//服务器返回json格式数据
		type:'get',//HTTP请求类型
		timeout:10000,//超时时间设置为10秒；
		headers:{'Content-Type':'application/json'},
		success:function(data){
			//服务器返回响应，根据响应结果，分析是否登录成功；
			var data=data;
			if(data.addressList.length==0){
				addr=false;
			}
			var html1 = template('test',data);
			document.getElementById("defaultAddress").innerHTML = html1;
			var html2 = template('wareList',data);
			document.getElementById("orderBox").innerHTML = html2;
//			var html3 = template('footer-content',data);
//			document.getElementById("footer-fixed").innerHTML = html3;
			document.getElementById("totalPrice_sum").innerHTML="￥"+data.final_sum;

		},
		error:function(xhr,type,errorThrown){
			//异常处理；
			console.log(type);
		}
	});
	//页面加载动画的调用
	$(window).load(function(){
		$("#loading").fadeOut(300);
	})
	var turn=true;
	//解决tab选项卡a标签无法跳转的问题
	mui('body').on('tap','a',function(){
			document.location.href=this.href;
	});
	mui('body').on('tap','#collapse-wareList',function(){
		if(turn){
			turn=false;
			document.querySelector('.icon-sign').className="mui-icon  mui-icon-arrowup icon-sign";
			document.getElementById("collapse-wareList-item").style.display='block';
		}else{
			turn=true;
			document.querySelector('.icon-sign').className="mui-icon  mui-icon-arrowdown icon-sign";
			document.getElementById("collapse-wareList-item").style.display='none';
		}
	});

</script>
</body>
</html>