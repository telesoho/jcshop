<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>九猫商城</title>
    <link rel="stylesheet" href="/views/mobile/skin/default/css/mui.css" />
    <link rel="stylesheet" href="/views/mobile/skin/default/css/icons-extra.css" />
    <link rel="stylesheet" href="/views/mobile/skin/default/css/common.css" />
    <link rel="stylesheet" href="/views/mobile/skin/default/css/app/jiumao.css" />
</head>
<body>
<!--loading页开始-->
<div id="loading">
    <div class="spinner">
        <div class="spinner-container container1">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
        <div class="spinner-container container2">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
        <div class="spinner-container container3">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
    </div>
</div>
<!--loading页结束-->
<!--下拉刷新容器-->
<!--<div id="pullrefresh" class="mui-content mui-scroll-wrapper">-->
    <!--<div class="mui-scroll" id="muiScroll">-->
        <!--头部-->
    <section class="homeHeader">
        <div class="nav-header">
            <div class="mui-input-row mui-search">
                <input type="search" id="searth"  placeholder="">
            </div>
        </div>
        <img src="/views/mobile/skin/default/image/jmj/icon/leftear.png" alt="" class="left-icon">
        <img src="/views/mobile/skin/default/image/jmj/icon/rightear.png" alt="" class="right-icon">
        <img src="/views/mobile/skin/default/image/jmj/icon/flower.png" alt="" class="img-flower">
    </section>
    <section id="nav-slider">
        <div  class="mui-slider">
            <div id="Control" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
                <div class="mui-scroll">
                    <a class="mui-control-item mui-active" href="{url:/site/index}">
                        <img src="/views/mobile/skin/default/image/jmj/icon/page1_bg1.png" alt=""  />
                        <span class="text">推荐</span>
                        <span class="bg"></span>
                    </a>
                    <a class="mui-control-item mui-control-item2" href="{url:/site/pro_list}?cat=2">
                        <img src="/views/mobile/skin/default/image/jmj/icon/page1_bg2.png" alt=""/>
                        <span class="text">药妆</span>
                        <span class="bg"></span>
                    </a>
                    <a class="mui-control-item mui-control-item3" href="{url:/site/pro_list}?cat=3">
                        <img src="/views/mobile/skin/default/image/jmj/icon/page1_bg3.png" alt=""  />
                        <span class="text">个护</span>
                        <span class="bg"></span>
                    </a>
                    <a class="mui-control-item mui-control-item4" href="{url:/site/pro_list}?cat=4">
                        <img src="/views/mobile/skin/default/image/jmj/icon/page1_bg4.png" alt="" />
                        <span class="text">宠物</span>
                        <span class="bg"></span>
                    </a>
                    <a class="mui-control-item mui-control-item5" href="{url:/site/pro_list}?cat=5">
                        <img src="/views/mobile/skin/default/image/jmj/icon/page1_bg5.png" alt="" />
                        <span class="text">健康</span>
                        <span class="bg"></span>
                    </a>
                    <!--<a class="mui-control-item" href="#">-->
                        <!--<span class="text">宠物</span><span class="bg"></span>-->
                    <!--</a>-->
                    <!--<a class="mui-control-item " href="#">-->
                        <!--<span class="text">健康</span><span class="bg"></span>-->
                    <!--</a>-->
                </div>
            </div>
        </div>
    </section>
        <!--轮播图-->
    <section>
        <div id="slider1" class="mui-slider" >
        </div>
        <!--轮播图结束-->
    </section>
        <!--专辑-->
        <!--<section class="timePurchase line">-->
            <!--<div class="timePurchase_title">-->
                <!--<div class="logo">-->
                    <!--<img src="/views/mobile/skin/default/image/jmj/icon/Panicbuying01.png" alt="" class="img-pan1">-->
                    <!--<span>限时抢购</span>-->
                    <!--<img src="/views/mobile/skin/default/image/jmj/icon/Panicbuying02.png" alt="" class="img-pan2">-->
                <!--</div>-->
                <!--<div id="timer" data_timer="0000000000" class="timer">-->
                    <!--<span id="timer_h">00</span>-->
                    <!--<span id="timer_m">00</span>-->
                    <!--<span id="timer_s">00</span>-->
                <!--</div>-->
                <!--<div class="right">-->
                    <!--<span class="mui-icon mui-icon-forward mui-pull-right"></span>-->
                    <!--<a href="index.php?controller=site&action=time_purchase"><span class=" mui-pull-right">更多</span></a>-->
                <!--</div>-->
            <!--</div>-->
            <!--<div class="timePurchase_body" id="timePurchase_body">-->
            <!--</div>-->
        <!--</section>-->
<div id="pullContainer"></div>
<div style="padding-bottom:2.42rem;background:#f8f8f8"></div>
<div class="fix-nav">
    <div class="img"><img src="/views/mobile/skin/default/image/jmj/icon/rmb.png" alt="" class="img-rmb"/>
        <div class="content">
            <span>19.32</span>
        </div>
    </div>
</div>
<div class="fix-toTop hide">
    <img src="/views/mobile/skin/default/image/jmj/icon/top-icon.png" alt=""  />
</div>
<footer>
    <nav class="mui-bar mui-bar-tab">
            <a id="defaultTab" class="mui-tab-item mui-active home" href="{url:/site/index}">
                <span class="mui-icon nav-icon icon-home"></span>
                <div class="mui-tab-label">首页</div>
            </a>
            <a class="mui-tab-item" href="{url:/site/sitemap}">
                <span class="mui-icon nav-icon icon-classification"></span>
                <div class="mui-tab-label">分类</div>
            </a>
            <a class="mui-tab-item" href="#">
                <span class="nav-icon icon-vedio">
                    <img src="/views/mobile/skin/default/image/jmj/icon/move02.png" alt="" class="img-move02">
                    <span class="tab-mark"></span>
                </span>
            </a>
            <a class="mui-tab-item" href="{url:simple/cart}">
                <span class="mui-icon nav-icon icon-shopcar"></span>
                <div class="mui-tab-label">购物车</div>
            </a>
            <a class="mui-tab-item" href="{url:/ucenter/index}">
                <span class="mui-icon nav-icon icon-my"></span>
                <div class="mui-tab-label">我的</div>
            </a>
    </nav>
</footer>
<!--模态框-->
<div id="modalid-searth" class="hide">
    <div class="title">
        猫猫都在搜
    </div>
    <div class="searth-content">
        <a href="#">万圣节</a>
        <a href="#">爱丽小屋</a>
        <a href="#">吃饱撑着</a>
        <a href="#">哈哈哈</a>
        <a href="#">英文</a>
        <a href="#">数字</a>
        <a href="#">万圣节</a>
        <a href="#">万圣节</a>
        <a href="#">万圣节</a>
        <a href="#">万圣节</a>
        <a href="#">万圣节</a>
    </div>
    <button type="button" id="button-submit" class="mui-btn  mui-btn-outlined buttom-submit" onclick="searthSubmit();">确定</button>
    <button type="button" id="button-cancel" class="mui-btn  mui-btn-outlined buttom-cancel" onclick="searthCancel();">取消</button>
</div>
<!--轮播图模板引擎-->
<script id="C_slider" type="text/html">
    <div class="mui-slider-group mui-slider-loop">
        <div class="mui-slider-item mui-slider-item-duplicate">
            <a href="<%=banner[banner.length-1].url %>">
                <img src="<%=banner[banner.length-1].img %>">
            </a>
        </div>
        <% for(var i=0; i<banner.length; i++){%>
        <% var dat =banner[i] %>
        <div class="mui-slider-item">
            <a href="<%=dat.url %>">
                <img src="<%=dat.img %>" class="samLazyImg">
            </a>
        </div>
        <%}%>
        <div class="mui-slider-item mui-slider-item-duplicate">
            <a href="<%=banner[0].url %>">
                <img src="<%=banner[0].img %>">
            </a>
        </div>
    </div>
    <div class="mui-slider-indicator" style="bottom:0.16rem;">
        <div class="mui-indicator mui-active"></div>
        <% for(var i=1; i<banner.length; i++){%>
        <div class="mui-indicator"></div>
        <%}%>
    </div>
</script>
<!--限时购模板引擎-->
<!--<script id="timeWare" type="text/html">-->
        <!--<% for(var i=0,m=child.length; i<m; i++){%>-->
        <!--<% var dat =child[i] %>-->
        <!--<div class="item">-->
            <!--<a href="index.php?controller=site&action=time_purchase"><div class="img" style="border:1px solid #eee">-->
                    <!--<img src="<%=dat.img %>" alt="" width="100%">-->
                    <!--<span><%=dat.award_value %></span>-->
                <!--</div>-->
                <!--<div class="text">-->
                    <!--<div class="title"><%=dat.name %></div>-->
                    <!--<div class="price"><s><span>￥</span><%=dat.sell_price %></s></div>-->
                <!--</div></a>-->
            <!--</div>-->
        <!--<%}%>-->
<!--</script>-->
<!--专辑分页模板-->
<script id="albumPage" type="text/html">
    <% for(var i=0; i<data.length; i++){%>
    <% var dat =data[i] %>
    <%if(dat.category_id==3){%>
    <!--视频专题-->
    <section class="vedio_album albumn_index">
        <div class="title">
            <span class="logo">
                <img src="/views/mobile/skin/default/image/jmj/icon/move.png" alt="" class="img-vedio">
            </span>
            <span class="vedio_name">
            動画のビデオ
                <span>
                    <img src="/views/mobile/skin/default/image/jmj/icon/address.png" alt="" class="img-address">日本东京
                </span>
            </span>
            <span class="num mui-pull-right" id="favorite<%=dat.id %>">
                <%=dat.favorite %>
            </span>
            <span class="like mui-pull-right">
                <%if(dat.is_favorite==0){%>
                <img src="/views/mobile/skin/default/image/jmj/icon/like.png" alt="" id="shareContent<%=dat.id %>" class="img-like"
                     onclick=collection(<%=dat.id %>) >
                <%}else{%>
                <img src="/views/mobile/skin/default/image/jmj/icon/like-ed.png" alt="" id="shareContent<%=dat.id %>" class="img-like" onclick=collection(<%=dat.id %>)  />
                <%}%>
            </span>
            <span class="share mui-pull-right">
                <img src="/views/mobile/skin/default/image/jmj/icon/share.png" alt="" class="img-share">
            </span>
        </div>
        <div class="vedio">
            <video class="player" src="http://f02.v1.cn/transcode/14410292MOBILET2.mp4"
                   width="100%" onpause="checkPause(this);" onplaying="checkPlay(this);" -webkit-playsinline webkit-playsinline>
            </video>
            <div class="vedioStyle">
                <div class="top">
                    <img src="/views/mobile/skin/default/image/jmj/icon/read.png" alt="" class="img-read"><%=dat.visit_num %>次
                </div>
                <div class="bottom">
                    <span class="name"><%=dat.name %>
                    </span>
                    <!--<span class="time">09:13</span>-->
                </div>
                <span class="time">09:13
                </span>
            </div>
            <div class="middle">
                <img src="/views/mobile/skin/default/image/jmj/icon/click.png" alt="" class="img-click">
            </div>
        </div>
    </section>
    <%}else{%>
    <%if(dat.category_id==1){%>
    <section class="recommended line albumn_index">
        <div class="title">
            <span class="logo" >
                <img src="/views/mobile/skin/default/image/jmj/icon/hot.png" alt="" class="img-hot">
            </span>
            <span class="name">
            特別推薦
            </span>
            <span class="num mui-pull-right" id="favorite<%=dat.id %>">
            <%=cal(dat.favorite) %>
            </span>
            <span class="like mui-pull-right">
                <%if(dat.is_favorite==0){%>
                <img src="/views/mobile/skin/default/image/jmj/icon/like.png" id="shareContent<%=dat.id %>" alt="" class="img-like" onclick="collection(<%=dat.id %>)" />
                <%}else{%>
                <img src="/views/mobile/skin/default/image/jmj/icon/like-ed.png" id="shareContent<%=dat.id %>" alt="" class="img-like" onclick=collection(<%=dat.id %>) />
                <%}%>
            </span>
        </div>
        <a href="index.php?controller=site&action=article_detail&id=<%=dat.id %>">
            <div class="content">
                <div class="img">
                    <img src="<%=dat.image %>" alt="" width="100%" style="height:3.8rem;" />
                </div>
                <div class="mark1"><%=dat.nums %>件商品
                </div>
                <div class="mark2">
                    <img src="/views/mobile/skin/default/image/jmj/icon/read.png" alt="">
                    <%=cal(dat.visit_num) %></div>
            </div>
        </a>
    </section>
    <%}else{%>
    <!--专辑-->
    <section class="recommended line albumn_index">
        <div class="title">
            <span class="logo">
                <img src="/views/mobile/skin/default/image/jmj/icon/hot.png" alt="" class="img-hot">
            </span>
            <span class="name">
            人気雑誌
            </span>
            <span class="num mui-pull-right" id="favorite<%=dat.id %>">
             <%=cal(dat.favorite) %>
            </span>
            <span class="like mui-pull-right">
               <%if(dat.is_favorite==0){%>
                <img src="/views/mobile/skin/default/image/jmj/icon/like.png" alt="" id="shareContent<%=dat.id %>" class="img-like" onclick=collection(<%=dat.id %>) />
                <%}else{%>
                <img src="/views/mobile/skin/default/image/jmj/icon/like-ed.png" alt="" id="shareContent<%=dat.id %>" class="img-like" onclick=collection(<%=dat.id %>)  />
                <%}%>
            </span>
            <span class="share mui-pull-right">
                <img src="/views/mobile/skin/default/image/jmj/icon/share.png" alt="" class="img-share">
            </span>
        </div>
        <a href="index.php?controller=site&action=article_detail&id=<%=dat.id %>">
            <div class="content">
                <div class="img">
                    <img src="<%=dat.image %>" alt="" width="100%" style="height:3.8rem;" />
                </div>
                <div class="mark1"><%=dat.nums %>件商品</div>
                <div class="mark2">
                    <img src="/views/mobile/skin/default/image/jmj/icon/read.png" alt="">
                    <%=cal(dat.visit_num) %></div>
            </div>
        </a>
    </section>
    <%}%>
    <%}%>
    <%}%>
</script>
<!--头信息结束-->
<script src="/views/mobile/javascript/mui.js"></script>
<script src="/views/mobile/javascript/template-native.js"></script>
<script src="/views/mobile/javascript/jquery.min.js"></script>
<script src="/views/mobile/javascript/lazyload.js"></script>
<script src="/views/mobile/javascript/time.js"></script>
<script>
    $(function(){
        if(typeof (ds) == "function") {
            ds = function(){};
        }
    });
    var pageData = {
        page:1
    };
    //页面加载完成后调用的功能
    window.onload=function(){
        $("#loading").fadeOut(300);
        getIndex();
        pullupRefresh();
        //解决tab选项卡a标签无法跳转的问题
        mui('body').on('tap','.mui-tab-item',function(){document.location.href=this.href;});
        mui('body').on('tap','a',function(){
            document.location.href=this.href;
        });
        mui('body').on('tap','video',function(){
            var self=this;
            if(this.paused){
                self.setAttribute("controls",'controls');
                $(self).next().addClass('hide');
                self.play();
            }else{
                self.setAttribute("controls",false);
                self.pause();
            }
        });
        mui('body').on('tap','.img-click',function(){
            var self=this;
            var self_Aid=self.parentNode;
//        self_Aid.previousSiblingNode.play();
            $(self_Aid).prev().addClass("hide");
            $(self_Aid).prev().prev()[0].play();


        });
        //点击直达顶部
        mui("body").on("tap",".fix-toTop",function(){
            $("html,body").animate({scrollTop:0},0);
            return false;
        });
    }

    document.getElementById("searth").addEventListener('focus',function(){
        document.getElementById("modalid-searth").className="show";
        document.body.style.overflow = 'hidden';
    });
    //处理分享数据
        template.helper('cal', function(obj){
            if(obj>=1000000){
                return parseInt(obj/1000000)+"万";
            }
            if(obj>=100000){
                return (obj/100000).toFixed(1)+"万";
            }
            if(obj>=10000){
                return (obj/10000).toFixed(2)+"万";
            }
            if(obj<10000){
                return obj;
            }
            return JSON.stringify(obj);
        });
//    mui.init({
//        pullRefresh: {
//            container: '#pullrefresh',
//        }
//    });
        //上拉加载
         var stop=true;
        $(window).bind('scroll', function() {
            if ($(window).scrollTop() + $(window).height() +1000 >= $(document).height() && $(window).scrollTop() > 50) {
                if(stop==true){
                    stop=false;
                    pullupRefresh()
                }
            }
            if($(window).scrollTop()>100){
                $(".fix-toTop").show();
                $(".fix-toTop").css("position","fixed");
            }else{
                $(".fix-toTop").hide();
                $(".fix-toTop").css("position","fixed");
            }
        });

    function pullupRefresh() {
        mui.ajax('index.php?controller=apic&action=article_list',{
            data:pageData,
            dataType:'json',	// 服务器返回json格式数据
            type:'post',		// HTTP请求类型
            timeout:10000,		// 超时时间设置为10秒；
            success:function(data){
                console.log(data);
                var pageAlbum={};
                pageAlbum.data=data;
                var html3=template('albumPage',pageAlbum);
                var div = document.createElement('div');
                div.innerHTML=html3;
                document.getElementById("pullContainer").appendChild(div);
//               mui('#pullrefresh').pullRefresh().endPullupToRefresh(pageData.page==data[0].totalpage);
                    stop = true;

                pageData.page++;
            },
            error:function(xhr,type,errorThrown){
                //异常处理；
                console.log(type);

            }
        });
    }
    function searthCancel(){
        document.getElementById("modalid-searth").className="hide";
        document.body.style.overflow = 'auto';
    }
    function searthSubmit(){
        var subContent=document.getElementById("searth").value;
        if(subContent==""){
            searthCancel();
        }else{
            window.location.href="home.html?item="+subContent;
        }
    }
    function getIndex(){
        mui.ajax('index.php?controller=apic&action=banner_list',{
            dataType:'json',//服务器返回json格式数据
            type:'get',//HTTP请求类型
            timeout:10000,//超时时间设置为10秒；
            success:function(data){
                console.log(data);
                $(".mui-placeholder span").eq(1).html(data.goods_nums+"件商品等你来搜")
                var html = template('C_slider',data);
                document.getElementById("slider1").innerHTML = html;
                var gallery = mui('#slider1');
                gallery.slider({
                    interval:3000//自动轮播周期，若为0则不自动播放，默认为0；
                });
//                获取限时购数据
//                getTimePurchase();
            },
            error:function(xhr,type,errorThrown){
                //异常处理；
            }
        });
    }
//    function getTimePurchase(){
//        var url1='index.php?controller=apic&action=pro_speed_list';
//        mui.ajax(url1,{
//            dataType:'json',//服务器返回json格式数据
//            type:'get',//HTTP请求类型
//            timeout:10000,//超时时间设置为10秒；
//            success:function(data1){
//                //服务器返回响应，根据响应结果，分析是否登录成功；
//                document.getElementById("timer").setAttribute("data_timer",data1.end_time);
//                var html2=template('timeWare',data1);
//                document.getElementById("timePurchase_body").innerHTML = html2;
//                timer('timer');
//            },
//            error:function(xhr,type,errorThrown){
//                //异常处理；
//                console.log(type);
//            }
//        });
//    }
    function checkPause(obj){
        var self=obj;
        $(self).next().next().removeClass("hide");
    }
    function checkPlay(obj){
        var self=obj;
        $(self).next().next().addClass("hide");
    }
    function collection(id){
        mui.ajax('index.php?controller=apic&action=favorite_article_add',{
            data:{
                id:id
            },
            dataType:'json',//服务器返回json格式数据
            type:'get',//HTTP请求类型
            timeout:10000,//超时时间设置为10秒；
            success:function(data){
                console.log(data);
                var num=document.getElementById("favorite"+id);
                var share=document.getElementById("shareContent"+id);
               if(data.message=="收藏成功"){
                        num.innerHTML=parseInt(num.innerHTML)+1;
                        share.src="/views/mobile/skin/default/image/jmj/icon/like-ed.png";
               }else{
                   num.innerHTML=parseInt(num.innerHTML)-1;
                   share.src="/views/mobile/skin/default/image/jmj/icon/like.png";
               }
            },
            error:function(xhr,type,errorThrown){
                //异常处理；
                console.log(type);
            }
        });
    }

</script>
</body>
</html>
