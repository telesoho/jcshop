<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<title>九猫商城</title>
	<link rel="stylesheet" href="/views/mobile/skin/default/css/mui.css" />
	<link rel="stylesheet" href="/views/mobile/skin/default/css/common.css" />
	<link rel="stylesheet" href="/views/mobile/skin/default/css/app/sitemap.css" />
</head>
<body>
<!--loading页开始-->
<div id="loading">
	<div class="spinner">
		<div class="spinner-container container1">
			<div class="circle1"></div>
			<div class="circle2"></div>
			<div class="circle3"></div>
			<div class="circle4"></div>
		</div>
		<div class="spinner-container container2">
			<div class="circle1"></div>
			<div class="circle2"></div>
			<div class="circle3"></div>
			<div class="circle4"></div>
		</div>
		<div class="spinner-container container3">
			<div class="circle1"></div>
			<div class="circle2"></div>
			<div class="circle3"></div>
			<div class="circle4"></div>
		</div>
	</div>
</div>
<!--loading页结束-->
<!--头部-->
<section class="homeHeader">
	<div class="nav-header">
		<div class="mui-input-row mui-search">
			<input type="search" id="searth"  placeholder="搜索你想要的品牌">
		</div>
	</div>
	<img src="/views/mobile/skin/default/image/jmj/icon/leftear.png" alt="" class="left-icon">
	<img src="/views/mobile/skin/default/image/jmj/icon/rightear.png" alt="" class="right-icon">
	<img src="/views/mobile/skin/default/image/jmj/icon/flower.png" alt="" class="img-flower">
</section>
<!--分类页面-->
<section class="box" id="scroll_sitemap">
	<div class="mui-scroll-wrapper" id="left-scroll">
		<div class="mui-scroll">
			<ul id="controlTop">
			</ul>
		</div>
	</div>
	<div class="mui-scroll-wrapper" id="right-scroll">
		<div class="mui-scroll" id="contentTop">
		</div>
	</div>
</section>
<footer>
	<nav class="mui-bar mui-bar-tab">
		<a id="defaultTab" class="mui-tab-item home" href="{url:/site/index}">
			<span class="mui-icon nav-icon icon-home"></span>
			<div class="mui-tab-label">首页</div>
		</a>
		<a class="mui-tab-item mui-active" href="{url:/site/sitemap}">
			<span class="mui-icon nav-icon icon-classification"></span>
			<div class="mui-tab-label">分类</div>
		</a>
		<a class="mui-tab-item" href="{url:/site/sitemap}">
                <span class="nav-icon icon-vedio">
                    <img src="/views/mobile/skin/default/image/jmj/icon/move02.png" alt="" class="img-move02">
                    <span class="tab-mark"></span>
                </span>
		</a>
		<a class="mui-tab-item" href="{url:simple/cart}">
			<span class="mui-icon nav-icon icon-shopcar"></span>
			<div class="mui-tab-label">购物车</div>
		</a>
		<a class="mui-tab-item" href="{url:/ucenter/index}">
			<span class="mui-icon nav-icon icon-my"></span>
			<div class="mui-tab-label">我的</div>
		</a>
	</nav>
</footer>
<!--模态框-->
<div id="modalid-searth" class="hide">
	<div class="title">
		大家都在搜
	</div>
	<div class="searth-content">
		<a href="#">万圣节</a>
		<a href="#">爱丽小屋</a>
		<a href="#">吃饱撑着</a>
		<a href="#">哈哈哈</a>
		<a href="#">英文</a>
		<a href="#">数字</a>
		<a href="#">万圣节</a>
		<a href="#">万圣节</a>
		<a href="#">万圣节</a>
		<a href="#">万圣节</a>
	</div>
	<button type="button" id="button-submit" class="mui-btn  mui-btn-outlined buttom-submit" onclick="searthSubmit();">确定</button>
	<button type="button" id="button-cancel" class="mui-btn  mui-btn-outlined buttom-cancel" onclick="searthCancel();">取消</button>
</div>
<!--<span class="mui-icon-extra mui-icon-extra-top" id="pagetop"></span>-->
<!--头信息结束-->
<!--一级分类-->
<script type="text/html" id="controlTopTemp">
	<% var allstring =JSONreduce(data) %>
	<% var string =JSONstringfly(data[0].image) %>
	<li class="controlItem controlItem<%=data[0].id%> active" onclick="changeSite(<%=data[0].id%>,0,<%=allstring%>)">
		<div class="content">
			<%if(data[0].image){%>
			<img src="<%=JSONsplit(data[0].image)[0]%>" alt="" class="icon img-red icon_first" id="icon_first_<%=data[0].id%>">
			<%}%>
			<span class="name"><%=data[0].name%></span>
			<span class="bg"></span>
		</div>
	</li>
	<% for(var i=1; i<data.length; i++){%>
	<% var Fsite =data[i] %>
	<% var string1 =JSONstringfly(Fsite.image) %>
		<li class="controlItem controlItem<%=Fsite.id%>" onclick="changeSite(<%=Fsite.id%>,<%=i%>,<%=allstring%>)">
			<div class="content">
				<%if(Fsite.image){%>
				<img src="<%=JSONsplit(Fsite.image)[1]%>" alt="" class="icon img-dark icon_first" id="icon_first_<%=Fsite.id%>">
				<%}%>
				<span class="name"><%=Fsite.name %></span>
				<span class="bg"></span>
			</div>
		</li>
	<%}%>
</script>
<script type="text/html" id="contentToptemp">
	<!--首个二级分类-->
	<div class="siteid site<%=data[0].id%>">
		<%if(data[0].banner_image){%>
		<div class="banner">
			<img src="<%=data[0].banner_image %>" alt="">
		</div>
		<%}%>
		<div class="S_classification">
			<% for(var j=0; j<data[0].child.length; j++){%>
			<% var Ssite =data[0].child[j] %>
			<div class="type">
				<a href="index.php?controller=site&action=category_third&id=<%=Ssite.id %>">
					<div class="img">
					<img src="<%=Ssite.image %>" alt="" width="1.54rem" height="1.54rem" style=""/>
					</div>
					<div class="name">
						<%=Ssite.name %>
					</div>
				</a>
			</div>
			<%}%>
		</div>
	</div>
	<!--其余二级分类-->
	<% for(var i=1; i<data.length; i++){%>
	<% var Fsite =data[i] %>
	<div class="siteid site<%=Fsite.id%> hide">
		<%if(Fsite.banner_image){%>
			<div class="banner">
				<img src="<%=Fsite.banner_image %>" alt="">
			</div>
		<%}%>
		<div class="S_classification">
			<% for(var j=0; j<Fsite.child.length; j++){%>
			<% var Ssite =Fsite.child[j] %>
				<div class="type">
					<a href="index.php?controller=site&action=category_third&id=<%=Ssite.id %>">
						<div class="img">
								<img src="<%=Ssite.image %>" alt="" width="1.54rem" height="1.54rem" style=""/>
						</div>
						<div class="name">
							<%=Ssite.name %>
						</div>
					</a>
				</div>
			<%}%>
		</div>
	</div>
	<%}%>
</script>
<script src="/views/mobile/javascript/mui.js"></script>
<script src="/views/mobile/javascript/template-native.js"></script>
<script src="/views/mobile/javascript/jquery.min.js"></script>

<script>
	//页面加载动画的调用
	$(window).load(function(){
		$("#loading").fadeOut(300);
		getSitemapInfo();
		//解决tab选项卡a标签无法跳转的问题
		mui('body').on('tap','.mui-tab-item',function(){document.location.href=this.href;});
		mui('body').on('tap','a',function(){document.location.href=this.href;});
		mui('.mui-scroll-wrapper').scroll();
	})
	document.getElementById("searth").addEventListener('focus',function(){
		document.getElementById("modalid-searth").className="show";
		document.body.style.overflow = 'hidden';
	});
	function searthCancel(){
		document.getElementById("modalid-searth").className="hide";
		document.body.style.overflow = 'auto';
	}
	function searthSubmit(){
		var subContent=document.getElementById("searth").value;
		if(subContent==""){
			searthCancel();
		}else{
			window.location.href="home.html?item="+subContent;
		}
	}
	template.helper('JSONsplit', function(obj){
		return obj.split(",")
	});
	template.helper('JSONreduce', function(obj){
		var arr=[];
		for(var m=0;m<obj.length;m++){
			arr.push(obj[m].image);
		}
		return JSON.stringify(arr)
	});
	template.helper('JSONstringfly', function(obj){
		return JSON.stringify(obj)
	});
	function getSitemapInfo(){
		mui.ajax('/apic/category_top',{
			dataType:'json',
			type:'get',
			timeout:10000,
			success:function(data){
				console.log(data);
				var dat={};
				dat.data=data;
				var html = template('controlTopTemp',dat);
				document.getElementById("controlTop").innerHTML=html;
				var html2 = template('contentToptemp',dat);
				document.getElementById("contentTop").innerHTML=html2;
			},
			error:function(xhr,type,errorThrown){
				//异常处理；
				console.log(type);
			}
		});
	}
	function changeSite(eid,num,obj){
		$(".controlItem").removeClass("active");
		$(".controlItem"+eid).addClass("active");
		$(".siteid").addClass("hide");
		$(".site"+eid).removeClass("hide");
		var height=$(".controlItem"+eid).height();
		var totalHeight=$("#left-scroll").height();
		var offsetTop=$(".controlItem"+eid).offset().top;//相对于容器的高度
//		点击改变图标状态
		var img_arr=[];
		for(var i=0,m=obj.length;i<m;i++){
			img_arr.push(obj[i].split(","));
			$(".icon_first").eq(i).attr("src",img_arr[i][1])
		}

		$("#icon_first_"+eid).attr("src",img_arr[num][0])
//		一级分类位置判定
		if(num<5){
			mui('#left-scroll').scroll().scrollTo(0,0,100);
		}
		if(offsetTop+height+100>totalHeight){
			mui('#left-scroll').scroll().scrollToBottom();
		}
	}
</script>
</body>
</html>

