<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>双十二折扣聚惠</title>
		<link rel="stylesheet" type="text/css" href="/views/mobile/skin/default/css/common.css?v=<?php echo time(); ?>"/>
		<link rel="stylesheet" type="text/css" href="/views/mobile/skin/default/css/app/cosme/activity_goods_list.css?v=<?php echo time(); ?>"/>
	</head>
	<style type="text/css">
		#list ul li .img{
			border-bottom: 1px solid #000;
			
		}
		#list ul li .img img{
			width: 3.4rem;
			height: 3.4rem;
		}
		#list ul li{
			height: 5.13rem;
			display: -webkit-box;
			background: #fff;
		}
		#list ul li p{
			margin-left:0.2rem ;
			margin-top: 0.12rem;
			
			overflow:hidden;
			display: -webkit-box;
			text-overflow:ellipsis;
			-webkit-line-clamp: 2;
			-o-text-overflow:ellipsis;
			width:90%;
		    -webkit-box-orient: vertical;
		    word-break: break-all;
		}
		#list ul li span{
			display: block;
			margin-left: 0.2rem;
		}
		#list ul li .xian{
			margin-bottom:0.01rem ;
		}
		#list ul .xian .pirce1{
			font-size:0.3rem ;
			
		}
		#wrap_logo{
			background: #ffc75b;
			height: 6rem;
			overflow: hidden;
		}
		#wrap_logo #logo{
			overflow: hidden;
		}
		.fix-toTop{
			position: fixed;
			right: 0.39rem;
		    bottom: 0.7rem;
		    z-index: 999;
		    width: 0.84rem;
		    height: 0.84rem;
		}
	</style>
	<body>
	<div id="activeInfo" style="overflow: hidden;" v-cloak>
		<div id="top" style="overflow: hidden;">
			<img src="/views/mobile/skin/default/image/jmj/active_goods_list/toplogo.png"/>
		</div>
		<div id="wrap_logo">
			<div id="logo">
			<div class="logo1">
				<a><img src="/views/mobile/skin/default/image/jmj/active_goods_list/snackArea.png" @click="lingshi()"/></a>
				<a><img src="/views/mobile/skin/default/image/jmj/active_goods_list/drugstoreArea.png" @click="yaozhuang()"/></a>
				<a><img src="/views/mobile/skin/default/image/jmj/active_goods_list/protectionZone.png" @click="gehu()"/></a>
				<a><img src="/views/mobile/skin/default/image/jmj/active_goods_list/healthArea.png" @click="jiankang()"/></a>
				<a><img src="/views/mobile/skin/default/image/jmj/active_goods_list/petArea.png" @click="chongwu()"/></a>	
			</div>
			<h1><img src="/views/mobile/skin/default/image/jmj/active_goods_list/title.png"/></h1>
			<div class="logo2">
				<img src="/views/mobile/skin/default/image/jmj/active_goods_list/zhuan.png"/>
				<div class="div1" @click="ranfa()"></div>
				<div class="div2" @click="hwyaozhuang()"></div>
				<div class="div3" @click="yama()"></div>
				<div class="div4" @click="reyanzhao()"></div>
			</div>
		</div>
		</div>
		<div id="shop_list">
			<div id="list">
				<ul>
					<li v-for="item in newData">
						<a :href="item.url">
						<div class="img"><img :src="item.img"/></div>
						<p>{{item.name}}</p>
						<span class="xian">现价:￥<t class="pirce1">{{item.sell_price}}</t></span>
						<span class="yuanjia">原价:<s>￥<t class="pirce2">{{item.original_price}}</t></s></span>
						<i><img src="/views/mobile/skin/default/image/jmj/active_goods_list/num.png"/></i>
					</a>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<!-- 							回到顶部										-->
	<div class="fix-toTop hide" @click="fixToTop">
        <img src="/views/mobile/skin/default/image/jmj/icon/top-icon.png" alt="" style="width: 0.84rem;height: 0.84rem;" />
    </div>
    
	<script src="/views/mobile/javascript/jquery.min.js?v=<?php echo time(); ?>"></script>
		<script src="/views/mobile/javascript/mui.js?v=<?php echo time(); ?>"></script>
		<script src="/views/mobile/javascript/vue.js?v=<?php echo time(); ?>"></script>
		<script>
			var opt = {
				page : 1,
			};
			var rrr = {
				bid:'',
				cid:'',
			};
			var arr = [];
			var str ="";
			var stop=true;
			var stop2 = true;
			var vm=new Vue({
				el:"#activeInfo",
				data: {
					page:1,
					info:[],
					val : {bid:'',cid:''},

				},
				computed:{
					newData: function(){
						this.info.map(function(item){
							item.url="/site/products?id="+item.id;
						})
						return this.info;
					}
				},
				mounted: function(){
					var self=this;
					getActiveInfo(self);
				},
				methods:{
					lingshi: function(){
						opt.page = 1;
					
						arr=[];
						str='';
						getActiveInfo2(7,'',self);
					},
					yaozhuang: function(){
						opt.page = 1;
					
						arr=[];
						str='';
						getActiveInfo2(126,'',self);
					},
					gehu: function(){
						opt.page = 1;
						this.info=[];
						arr=[];
						str='';
						getActiveInfo2(134,'',self);
					},
					jiankang: function(){
						opt.page = 1;
						
						arr=[];
						str='';
						getActiveInfo2(2,'',self);
					},
					chongwu: function(){
						opt.page = 1;
						this.info=[];
						arr=[];
						str='';
						getActiveInfo2(6,'',self);
					},
					ranfa: function(){
						opt.page = 1;
						
						arr=[];
						str='';
						getActiveInfo2(62,74,self);
					},
					hwyaozhuang: function(){
						opt.page = 1;
	
						arr=[];
						str='';
						getActiveInfo2("134,135,136",74,self);
					},
					yama: function(){
						opt.page = 1;

						arr=[];
						str='';
						getActiveInfo2(98,74,self);
					},
					reyanzhao: function(){
						opt.page = 1;

						arr=[];
						str='';
						getActiveInfo2("91,152",74,self);
					}
				}
			})
			
			function getActiveInfo2(cid,bid,self){
					stop=false;
					cid = (cid==	undefined ? '' : cid);
					bid = (bid==	undefined ? '' : bid);
					rrr.bid = bid;
					rrr.cid = cid;
					var bb = {
						data:{
							page:opt.page,
							cid:rrr.cid,
							bid:rrr.bid
						},
						dataType:'json',//服务器返回json格式数据
						type:'get',//HTTP请求类型
						timeout:10000,//超时时间设置为10秒；
						success:function(data){
//							console.log(1)
//							
							for(var i=0;i<data.data.length;i++){
								
								str += '<li>\
											<a>\
											<span title='+data.data[i].id+'></span>\
											<div class="img"><img src='+data.data[i].img+'/></div>\
											<p>'+data.data[i].name+'</p>\
											<span class="xian">现价:￥<t class="pirce1">'+data.data[i].sell_price+'</t></span>\
											<span class="yuanjia">原价:<s>￥<t class="pirce2">'+data.data[i].original_price+'</t></s></span>\
											<i><img src="/views/mobile/skin/default/image/jmj/active_goods_list/num.png"/></i>\
										</a>\
										</li>'
							}
							arr.push(str);
							for(var i in arr){
								$("#list ul").html(arr[i]);
							}
							if(data.data==''){
								stop2=false;				
							}else{
								opt.page ++;
								stop2=true;
							}
							var spannum = $("#list ul li span").attr("title")
							$("#list ul li").click(function(){
								window.location.href = "/site/products?id="+spannum;
							})		
						}
					}
					mui.ajax('/apic/activity_goods_list',bb);
			}	
			//第一次
			function getActiveInfo(self){
					var aa = {
						data:{
							page:opt.page,
							cid:"",
							bid:"",
						},
						dataType:'json',//服务器返回json格式数据
						type:'get',//HTTP请求类型
						timeout:10000,//超时时间设置为10秒；
						success:function(data){
							for(var i=0;i<data.data.length;i++){
								self.info.push(data.data[i])
							}
							if(data.data==''){
								stop=false;
							}else{
								opt.page++;
								stop=true;
							}
						}
					};
					mui.ajax('/apic/activity_goods_list',aa);	
			}
			//上拉加载
			$(window).bind('scroll', function(){
				
				if ($(window).scrollTop() + $(window).height() +1000 >= $(document).height() && $(window).scrollTop() > 50) {
					if(stop==true){
						stop=false;
						getActiveInfo(vm);
					}
					if(stop2==true){
						stop2=false;
						getActiveInfo2(rrr.cid,rrr.bid);
					}
				}
				
				if (document.body.scrollTop>50){
					$(".fix-toTop").show();
					$(".fix-toTop").click(function(){
						document.body.scrollTop = 0;
						document.documentElement.scrollTop =0;
					})
				}else{
					$(".fix-toTop").hide()
				}
			});
			//回到顶部
			
		</script>
	</body>
</html>
