<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>双十二折扣聚惠</title>
		<link rel="stylesheet" type="text/css" href="/views/mobile/skin/default/css/common.css?v=<?php echo time(); ?>"/>
		<link rel="stylesheet" type="text/css" href="/views/mobile/skin/default/css/app/cosme/activity_goods_list.css?v=<?php echo time(); ?>"/>
	</head>
	<body>
	<div id="activeInfo" v-cloak>
		<div id="top">
			<img src="/views/mobile/skin/default/image/jmj/active_goods_list/toplogo.png"/>
		</div>
		
		<div id="logo">
			<div class="logo1" style="overflow: hidden;">
				<a><img src="/views/mobile/skin/default/image/jmj/active_goods_list/snackArea.png" @click="lingshi()"/></a>
				<a><img src="/views/mobile/skin/default/image/jmj/active_goods_list/drugstoreArea.png" @click="yaozhuang()"/></a>
				<a><img src="/views/mobile/skin/default/image/jmj/active_goods_list/protectionZone.png" @click="gehu()"/></a>
				<a><img src="/views/mobile/skin/default/image/jmj/active_goods_list/healthArea.png" @click="jiankang()"/></a>
				<a><img src="/views/mobile/skin/default/image/jmj/active_goods_list/petArea.png" @click="chongwu()"/></a>	
			</div>
			<h1><img src="/views/mobile/skin/default/image/jmj/active_goods_list/title.png"/></h1>
			<div class="logo2">
				<img src="/views/mobile/skin/default/image/jmj/active_goods_list/zhuan.png"/>
				<div class="div1" @click="ranfa()"></div>
				<div class="div2" @click="hwyaozhuang()"></div>
				<div class="div3" @click="yama()"></div>
				<div class="div4" @click="reyanzhao()"></div>
			</div>
		</div>
	
		<div id="shop_list">
			<div id="list">
				<ul>
					<li v-for="item in newData">
						<a :href="item.url">
						<div class="img"><img :dataimg="item.img" src="/views/mobile/skin/default/image/jmj/product/ware_lazy.png" alt="" class="samLazyImg"
						/></div>
						<p>{{item.name}}</p>
						<span class="xian">现价:￥<t class="pirce1">{{item.sell_price}}</t></span>
						<span class="yuanjia">原价:<s>￥<t class="pirce2">{{item.original_price}}</t></s></span>
						<i><img src="/views/mobile/skin/default/image/jmj/active_goods_list/num.png"/></i>
					</a>
					</li>
				</ul>
			</div>
		</div>
		<div class="flexbox empty_product" v-if="infoState" style="background:#ffc75b">
			<div class="img">
				<img src="/views/mobile/skin/default/image/jmj/icon/nomore.png" alt=""/>
			</div>
			<div class="content">
				<span style="color:#fff">~</span>
				<span style="color:#fff">憋拉了，到底了</span>
				<span style="color:#fff">~</span>
			</div>
		</div>
	</div>
	<!-- 							回到顶部										-->
	<div class="fix-toTop hide" @click="fixToTop">
        <img src="/views/mobile/skin/default/image/jmj/icon/top-icon.png" alt="" style="width: 0.84rem;height: 0.84rem;" />
    </div>
		<script src="/views/mobile/javascript/lazyload.js?v=<?php echo time(); ?>"></script>
		<script src="/views/mobile/javascript/jquery.min.js?v=<?php echo time(); ?>"></script>
		<script src="/views/mobile/javascript/mui.js?v=<?php echo time(); ?>"></script>
		<script src="/views/mobile/javascript/vue.js?v=<?php echo time(); ?>"></script>
		<script src="/views/mobile/javascript/jiumao/common.js?v=<?php echo time(); ?>"></script>
		<script>
			var stop=true;
			var vm=new Vue({
				el:"#activeInfo",
				data: {
					page:1,
					info:[],
					val : {bid:'',cid:''},
					infoState:false
				},
				computed:{
					newData: function(){
						this.info.map(function(item){
							item.url="/site/products?id="+item.id;
						});
						return this.info;
					}
				},
				mounted: function(){
					var self=this;
					if(getSession("active_info")){
						self.val=getSession("active_val");
						self.info=getSession("active_info");
						self.page=getSession("active_page")
					}else{
						self.page=1;
						getActiveInfo(self);
					}
				},
				updated:function() {
					// 页面加载完成执行的函数;
					lazyload.init({
						anim:false,
						selectorName:".samLazyImg"
					});
				},
				methods:{
					lingshi: function(){
						var self=this;
						removeSessionItem("active_info");
						removeSessionItem("active_val");
						self.info=[];
						self.page=1;
						self.val.cid=7;
						pushSession("active_val",self.val);
						getActiveInfo(self)

					},
					yaozhuang: function(){
						var self=this;
						removeSessionItem("active_val");
						removeSessionItem("active_info");
						self.info=[];
						self.page=1;
						self.val.cid=126;
						self.val.bid='';
						pushSession("active_val",self.val);
						getActiveInfo(self)
					},
					gehu: function(){
						var self=this;
						removeSessionItem("active_val");
						removeSessionItem("active_info");
						self.info=[];
						self.page=1;
						self.val.cid=134;
						self.val.bid='';
						pushSession("active_val",self.val);
						getActiveInfo(self)
					},
					jiankang: function(){
						var self=this;
						removeSessionItem("active_val");
						removeSessionItem("active_info");
						self.info=[];
						self.page=1;
						self.val.cid=2;
						self.val.bid='';
						pushSession("active_val",self.val);
						getActiveInfo(self)
					},
					chongwu: function(){
						var self=this;
						removeSessionItem("active_val");
						removeSessionItem("active_info");
						self.info=[];
						self.page=1;
						self.val.cid=6;
						self.val.bid='';
						pushSession("active_val",self.val);
						getActiveInfo(self)
					},
					ranfa: function(){
						var self=this;
						removeSessionItem("active_val");
						removeSessionItem("active_info");
						self.info=[];
						self.page=1;
						self.val={
							cid:62,
							bid:74
						};
						pushSession("active_val",self.val);
						getActiveInfo(self)
					},
					hwyaozhuang: function(){
						var self=this;
						removeSessionItem("active_val");
						removeSessionItem("active_info");
						self.info=[];
						self.page=1;
						self.val={
							cid:"134,135,136",
							bid:74
						};
						pushSession("active_val",self.val);
						getActiveInfo(self)
					},
					yama: function(){
						var self=this;
						removeSessionItem("active_val");
						removeSessionItem("active_info");
						self.info=[];
						self.page=1;
						self.val={
							cid:98,
							bid:74
						};
						pushSession("active_val",self.val);
						getActiveInfo(self)
					},
					reyanzhao: function(){
						var self=this;
						removeSessionItem("active_val");
						removeSessionItem("active_info");
						self.info=[];
						self.page=1;
						self.val={
							cid:"91,152",
							bid:74
						};
						pushSession("active_val",self.val);
						getActiveInfo(self);
					}
				}
			});

			function getActiveInfo(self){
				mui.ajax('/apic/activity_goods_list', {
					data:{
						page:self.page,
						cid:self.val.cid,
						bid:self.val.bid
					},
					dataType: 'json',
					type: 'get',
					timeout: 10000,
					success: function (data) {
						data.data.map(function(item){
							self.info.push(item);
						})
						if(data.data==''){
							self.infoState=true;
							stop=false;
						}else{
							stop=true;
							self.infoState=false;
						}
						pushSession("active_info",self.info);

						self.page++;
						pushSession("active_page",self.page);
//						pushSession("article_category_list",self.indexInfo.article_category_list);
					},
					error: function(type){
					}
				});
			}
			//上拉加载
			$(window).bind('scroll', function(){
				if ($(window).scrollTop() + $(window).height() +1000 >= $(document).height() && $(window).scrollTop() > 50) {
					if(stop==true){
						stop=false;
						getActiveInfo(vm);
					}
				}
				if (document.body.scrollTop>50){
					$(".fix-toTop").show();
					$(".fix-toTop").click(function(){
						document.body.scrollTop = 0;
						document.documentElement.scrollTop =0;
					})
				}else{
					$(".fix-toTop").hide()
				}
			});

//			缓	存
			function pushSession(key,value){
				var val	= JSON.stringify(value)?JSON.stringify(value):[];
				if(window.sessionStorage){
					sessionStorage.setItem(key,val);
				}else{
					console.log("无法使用缓存");
					return "";
				}
			}
			function getSession(key){
				if(window.sessionStorage){
					var state=sessionStorage.getItem(key)?sessionStorage.getItem(key):0;
					return JSON.parse(state);
				}else{
					console.log("无法使用缓存");
					return "";
				}
			}
			function removeSessionItem(key){
				window.sessionStorage.removeItem(key);
			}
		</script>
	</body>
</html>
